---
layout:     post
title:      Mysql集群
subtitle:   Docker集群部署Mysql以及负载均衡方案
date:       2019-10-29
author:     yym439
header-img: img/post-web.jpg
catalog: true
tags:
    - Linux 
    - Docker
---

## 1、Mysql集群
![Mysql集群方案](https://yym439.github.io/img/docker-8.png "Mysql集群方案")

![方案比较](https://yym439.github.io/img/docker-9.png "方案比较")

### 1.1 PXC镜像安装
![PXC安装](https://yym439.github.io/img/docker-10.png "daocloud PXC安装")

### 2.2 创建内部网络
![创建内部网络](https://yym439.github.io/img/docker-11.png "创建内部网络")

> docker network create --subnet=172.18.0.0/24  net1  (需要指定subnet参数)

### 1.3 Docker卷

pxc无法使用目录映射直接保存数据到宿主机，所以需要Docker卷:

> docker volume create --name v1 （创建数据卷）

> docker inspect v1  (查看数据卷存放在宿主机哪一个位置)

> docker volume rm v1  (删除数据卷)

### 1.4 创建PXC容器集群
![创建PXC容器](https://yym439.github.io/img/docker-12.png "创建PXC容器")

参数说明：
> -d 启动容器后再后台运行
> -p 端口映射
> -v 路径映射（pxc要使用数据卷去映射，不能直接使用宿主机路径映射）
> -e 配置启动参数
> --net PXC容器内部网段设置
> --ip 容器内部网段ip设置

例子(创建5个PXC容器集群)：
``` docker
docker network create --subnet=172.18.0.0/24 net1

docker volume create --name v1
docker volume create --name v2
docker volume create --name v3
docker volume create --name v4
docker volume create --name v5

docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -e CLUSTER_NAME=PXC -e XTRABACKUP_PASSWORD=123456 -v v1:/var/lib/mysql --privileged --name node1 --net=net1  --ip 172.18.0.2  pxc(镜像名称)

docker run -d -p 3307:3306 -e MYSQL_ROOT_PASSWORD=123456 -e CLUSTER_NAME=PXC -e XTRABACKUP_PASSWORD=123456 -e CLUSTER_JOIN=node1 -v v2:/var/lib/mysql --privileged --name node2 --net=net1  --ip 172.18.0.3  pxc

docker run -d -p 3308:3306 -e MYSQL_ROOT_PASSWORD=123456 -e CLUSTER_NAME=PXC -e XTRABACKUP_PASSWORD=123456 -e CLUSTER_JOIN=node1 -v v3:/var/lib/mysql --privileged --name node3 --net=net1  --ip 172.18.0.4  pxc

docker run -d -p 3309:3306 -e MYSQL_ROOT_PASSWORD=123456 -e CLUSTER_NAME=PXC -e XTRABACKUP_PASSWORD=123456 -e CLUSTER_JOIN=node1 -v v4:/var/lib/mysql --privileged --name node4 --net=net1  --ip 172.18.0.5  pxc

docker run -d -p 3310:3306 -e MYSQL_ROOT_PASSWORD=123456 -e CLUSTER_NAME=PXC -e XTRABACKUP_PASSWORD=123456 -e CLUSTER_JOIN=node1 -v v5:/var/lib/mysql --privileged --name node5 --net=net1  --ip 172.18.0.6  pxc
```
### 2、Mysql负载均衡
